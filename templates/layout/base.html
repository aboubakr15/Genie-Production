{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <title style="align-items: center;">The Genie</title>
  <link rel="icon" href="{% static 'assets/Genie_logo.jpeg' %}" type="image/x-icon">
  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Google Fonts - Preconnect for faster loading -->
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Bootstrap CSS (single source - using CDN version, removed duplicate local) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@latest/dist/bootstrap-table.min.css">

  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <!-- Vendor CSS Files - Essential icon libraries (kept for design) -->
  <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <link href="{% static 'assets/vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/quill/quill.snow.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/quill/quill.bubble.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/remixicon/remixicon.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/simple-datatables/style.css' %}" rel="stylesheet">

  <!-- Optional Vendor CSS - Only load when needed via block (for pages that need them) -->
  {% block extra_css %}{% endblock %}

  <!-- Template Main CSS File -->
  <link href="{% static 'assets/css/style.css' %}" rel="stylesheet" />

  <style>
    :root {
      --primary-color: #4a2c7a;
      --secondary-color: #8e44ad;
      --accent-color: #ffd700;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --bg-gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color), #3498db);
      --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --font-primary: 'Poppins', sans-serif;
      --font-secondary: 'Inter', sans-serif;
    }

    body {
      font-family: var(--font-primary);
      background: #f8f9fa;
      color: var(--text-primary);
    }

    /* Main Content Adjustment */
    .main {
      margin-left: 80px;
      padding: 20px;
      transition: var(--transition-smooth);
    }

    @media (min-width: 1200px) {
      .main {
        margin-left: 80px;
      }

      .sidebar:hover+.main {
        margin-left: 300px;
      }
    }

    @media (max-width: 1199.98px) {
      .main {
        margin-left: 0;
      }
    }

    /* Modern Card Styles */
    .card {
      background: white;
      border-radius: 15px;
      border: none;
      box-shadow: var(--card-shadow);
      transition: var(--transition-smooth);
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-body {
      padding: 1.5rem;
    }

    /* Button Styles */
    .btn {
      border-radius: 8px;
      padding: 0.5rem 1.5rem;
      font-weight: 500;
      transition: var(--transition-smooth);
    }

    .btn-primary {
      background: var(--bg-gradient);
      border: none;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(74, 44, 122, 0.3);
    }

    /* Table Styles */
    .table {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }

    .table thead th {
      background: var(--bg-gradient);
      color: white;
      font-weight: 500;
      border: none;
    }

    /* Form Controls */
    .form-control {
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      padding: 0.75rem 1rem;
      transition: var(--transition-smooth);
    }

    .form-control:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.1);
    }

    /* Alert Styles */
    .alert {
      border-radius: 10px;
      border: none;
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--secondary-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-color);
    }
  </style>

</head>

<body>
  {% include "layout/header.html" %}
  {% include 'layout/sidebar.html' %}
  <main id="main" class="main">

    <!-- Message Display -->
    {% if messages %}
    <div class="container mt-4">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% block content %} {% endblock %}
  </main>
</body>

<!-- Core JavaScript - Removed duplicates, kept single versions -->
<!-- jQuery (removed duplicate, kept single version) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap JS (removed 2 duplicates, kept single CDN version) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@latest/dist/bootstrap-table.min.js"></script>

<!-- Select2 -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Template Main JS File -->
<script src="{% static 'assets/js/main.js' %}"></script>

<!-- Optional Vendor JS - Only load when needed via block (for pages that need charts/editors) -->
{% block extra_js %}{% endblock %}

<script>

  (function () {
    let timeout; // Use `let` to prevent global variable issues

    function resetTimeout() {
      clearTimeout(timeout);
      // Set a timeout to log inactivity after 5 minutes (300000 milliseconds)
      timeout = setTimeout(logInactivity, 300000); // Adjusted to 5 minutes
    }

    function logInactivity() {
      console.log("Logging user inactivity...");

      fetch("{% url 'main:log_inactivity' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          message: "User inactive for 5 minutes",
        }),
      })
        .then((response) => {
          if (response.ok) {
            console.log("Inactivity logged successfully.");
          } else {
            console.error("Logging inactivity failed:", response);
          }
        })
        .catch((error) => console.error("Error logging inactivity:", error));
    }

    // Reset the inactivity timeout whenever there is any user activity
    const events = ['mousemove', 'keydown', 'click', 'scroll', 'touchstart'];

    events.forEach(event => {
      document.addEventListener(event, resetTimeout);
    });

    // Start the inactivity timer
    resetTimeout();
  })();

</script>


</html>